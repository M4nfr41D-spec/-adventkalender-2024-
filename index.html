<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>‚ú® Magischer Adventskalender Generator Pro 2025 ‚ú®</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,minimum-scale=1.0,maximum-scale=5.0,user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1a0033">
<meta name="format-detection" content="telephone=no">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #9d4edd;
  --secondary: #c77dff;
  --accent: #e0aaff;
  --bg-dark: #0a0015;
  --bg-medium: #1a0033;
  --bg-light: #2d1b4e;
  --text-primary: #f0e6ff;
  --text-secondary: #d4c5f0;
  --gold: #ffd700;
  --silver: #c0c0c0;
  --success: #4ade80;
  --warning: #fbbf24;
  --danger: #ef4444;
  --border-radius: 20px;
  --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  --safe-area-inset-top: env(safe-area-inset-top, 0px);
  --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
  --safe-area-inset-left: env(safe-area-inset-left, 0px);
  --safe-area-inset-right: env(safe-area-inset-right, 0px);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

html {
  scroll-behavior: smooth;
  height: 100%;
  touch-action: manipulation;
}

body {
  font-family: 'Quicksand', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #0a0015 0%, #1a0033 25%, #2d1b4e 50%, #1a0033 75%, #0a0015 100%);
  background-attachment: fixed;
  color: var(--text-primary);
  min-height: 100vh;
  min-height: -webkit-fill-available;
  padding: calc(20px + var(--safe-area-inset-top)) 
           calc(20px + var(--safe-area-inset-right)) 
           calc(20px + var(--safe-area-inset-bottom)) 
           calc(20px + var(--safe-area-inset-left));
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  position: relative;
  overflow-x: hidden;
}

/* Magical Background Effects */
@keyframes auroraFlow {
  0%, 100% { 
    background-position: 0% 50%, 100% 50%;
    filter: hue-rotate(0deg);
  }
  50% { 
    background-position: 100% 50%, 0% 50%;
    filter: hue-rotate(30deg);
  }
}

@keyframes twinkle {
  0%, 100% { 
    opacity: 0.3;
    transform: scale(0.8) rotate(0deg);
  }
  50% { 
    opacity: 1;
    transform: scale(1.2) rotate(180deg);
  }
}

@keyframes float {
  0%, 100% { transform: translateY(0) rotate(-2deg); }
  50% { transform: translateY(-20px) rotate(2deg); }
}

@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

@keyframes pulse {
  0%, 100% { 
    box-shadow: 0 0 20px var(--primary), 
                0 0 40px var(--secondary),
                inset 0 0 15px rgba(255,255,255,0.1);
  }
  50% { 
    box-shadow: 0 0 40px var(--primary), 
                0 0 80px var(--secondary),
                inset 0 0 30px rgba(255,255,255,0.2);
  }
}

body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: 
    radial-gradient(ellipse at 20% 20%, rgba(157, 78, 221, 0.15), transparent 50%),
    radial-gradient(ellipse at 80% 30%, rgba(199, 125, 255, 0.12), transparent 50%),
    radial-gradient(ellipse at 50% 80%, rgba(224, 170, 255, 0.1), transparent 50%);
  animation: auroraFlow 20s ease-in-out infinite;
  pointer-events: none;
  z-index: 1;
}

.stars {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 2;
}

.star {
  position: absolute;
  width: 3px;
  height: 3px;
  background: white;
  border-radius: 50%;
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
  animation: twinkle 3s ease-in-out infinite;
}

.container {
  max-width: 900px;
  width: 100%;
  position: relative;
  z-index: 10;
}

/* Header */
.header {
  text-align: center;
  margin-bottom: 40px;
  position: relative;
  animation: float 6s ease-in-out infinite;
}

.header::before,
.header::after {
  content: "‚ùÑ";
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 2.5rem;
  color: var(--accent);
  animation: twinkle 2s ease-in-out infinite;
}

.header::before { left: -15px; }
.header::after { right: -15px; }

h1 {
  font-family: 'Cinzel Decorative', serif;
  font-size: clamp(2rem, 5vw, 3.5rem);
  font-weight: 900;
  background: linear-gradient(135deg, var(--gold), var(--accent), var(--primary), var(--accent), var(--gold));
  background-size: 200% 200%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: shimmer 3s linear infinite;
  letter-spacing: 2px;
  text-transform: uppercase;
  filter: drop-shadow(0 0 30px rgba(157, 78, 221, 0.5));
}

.subtitle {
  font-family: 'Playfair Display', serif;
  font-size: 1.1rem;
  color: var(--secondary);
  margin-top: 10px;
  font-style: italic;
  opacity: 0.9;
}

/* Main Card */
.card {
  background: linear-gradient(145deg, rgba(26, 0, 51, 0.95), rgba(45, 27, 78, 0.9));
  border: 2px solid var(--primary);
  border-radius: var(--border-radius);
  padding: 30px;
  box-shadow: 0 20px 60px rgba(157, 78, 221, 0.3),
              0 0 100px rgba(157, 78, 221, 0.1),
              inset 0 0 30px rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  position: relative;
  overflow: hidden;
  animation: pulse 4s ease-in-out infinite;
}

.card::before {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: conic-gradient(from 0deg, transparent, rgba(157, 78, 221, 0.1), transparent, rgba(199, 125, 255, 0.1), transparent);
  animation: rotate 20s linear infinite;
  pointer-events: none;
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* Form Elements */
.form-group {
  margin-bottom: 25px;
  position: relative;
}

label {
  display: block;
  font-family: 'Playfair Display', serif;
  font-weight: 700;
  font-size: 1.1rem;
  color: var(--accent);
  margin-bottom: 10px;
  text-shadow: 0 0 20px rgba(224, 170, 255, 0.5);
}

input[type="file"],
input[type="text"],
select,
textarea {
  width: 100%;
  padding: 15px 20px;
  border: 2px solid rgba(157, 78, 221, 0.3);
  border-radius: 15px;
  background: linear-gradient(135deg, rgba(20, 10, 40, 0.8), rgba(30, 15, 55, 0.7));
  color: var(--text-primary);
  font-size: 1rem;
  font-family: 'Quicksand', sans-serif;
  transition: var(--transition);
  box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
  -webkit-appearance: none;
  appearance: none;
}

input[type="file"] {
  cursor: pointer;
  padding: 20px;
}

input[type="file"]::-webkit-file-upload-button {
  display: none;
}

input:hover,
textarea:hover,
select:hover {
  border-color: var(--secondary);
  transform: translateY(-2px);
  box-shadow: 0 5px 20px rgba(157, 78, 221, 0.3),
              inset 0 2px 10px rgba(0, 0, 0, 0.3);
}

input:focus,
textarea:focus,
select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 30px rgba(224, 170, 255, 0.4),
              inset 0 2px 15px rgba(0, 0, 0, 0.4);
}

::placeholder {
  color: rgba(224, 170, 255, 0.4);
  font-style: italic;
}

select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23e0aaff' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 15px center;
  padding-right: 45px;
  cursor: pointer;
}

/* Info Box */
.info-box {
  background: linear-gradient(135deg, rgba(157, 78, 221, 0.1), rgba(224, 170, 255, 0.05));
  border-left: 3px solid var(--accent);
  border-radius: 10px;
  padding: 20px;
  margin: 25px 0;
  position: relative;
  overflow: hidden;
}

.info-box::before {
  content: "‚ÑπÔ∏è";
  position: absolute;
  top: 20px;
  left: 20px;
  font-size: 1.5rem;
  opacity: 0.5;
}

.info-box p {
  padding-left: 40px;
  color: var(--text-secondary);
  line-height: 1.6;
  font-size: 0.95rem;
}

/* Buttons */
.btn {
  padding: 15px 35px;
  font-family: 'Playfair Display', serif;
  font-size: 1.1rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 2px;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  text-decoration: none;
  color: white;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  box-shadow: 0 10px 30px rgba(157, 78, 221, 0.4),
              inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

.btn-primary::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  background: radial-gradient(circle, rgba(255, 255, 255, 0.3), transparent);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

.btn-primary:hover {
  transform: translateY(-3px) scale(1.02);
  box-shadow: 0 15px 40px rgba(157, 78, 221, 0.5),
              inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

.btn-primary:hover::before {
  width: 300px;
  height: 300px;
}

.btn-primary:active {
  transform: translateY(-1px) scale(1);
}

.btn-success {
  background: linear-gradient(135deg, #10b981, #34d399);
  box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
}

.btn-group {
  display: flex;
  gap: 20px;
  justify-content: center;
  flex-wrap: wrap;
  margin-top: 30px;
}

/* Progress Indicator */
.progress {
  width: 100%;
  height: 8px;
  background: rgba(157, 78, 221, 0.2);
  border-radius: 10px;
  overflow: hidden;
  margin: 20px 0;
}

.progress-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--accent));
  border-radius: 10px;
  transition: width 0.5s ease;
  animation: shimmer 2s linear infinite;
}

/* Modal Styles */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(10, 0, 21, 0.95);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 1000;
  padding: 20px;
  overflow-y: auto;
  animation: fadeIn 0.3s ease;
}

.modal.active {
  display: flex;
  align-items: center;
  justify-content: center;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.modal-content {
  background: linear-gradient(145deg, var(--bg-medium), var(--bg-light));
  border: 2px solid var(--primary);
  border-radius: var(--border-radius);
  max-width: 600px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  padding: 30px;
  position: relative;
  animation: slideUp 0.4s ease;
  box-shadow: 0 20px 60px rgba(157, 78, 221, 0.4);
}

@keyframes slideUp {
  from { 
    transform: translateY(50px);
    opacity: 0;
  }
  to { 
    transform: translateY(0);
    opacity: 1;
  }
}

.close-modal {
  position: absolute;
  top: 15px;
  right: 15px;
  width: 40px;
  height: 40px;
  background: rgba(239, 68, 68, 0.2);
  border: 2px solid var(--danger);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: var(--transition);
  font-size: 1.5rem;
  color: var(--danger);
}

.close-modal:hover {
  background: var(--danger);
  color: white;
  transform: rotate(90deg) scale(1.1);
}

/* Success Message */
.success-message {
  background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(52, 211, 153, 0.1));
  border: 2px solid var(--success);
  border-radius: 15px;
  padding: 20px;
  margin: 20px 0;
  text-align: center;
  animation: pulse 2s ease-in-out infinite;
}

.success-message h3 {
  color: var(--success);
  font-size: 1.3rem;
  margin-bottom: 10px;
}

/* Loading Spinner */
.spinner {
  width: 50px;
  height: 50px;
  border: 3px solid rgba(157, 78, 221, 0.2);
  border-top-color: var(--primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin: 20px auto;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Responsive Design */
@media (max-width: 768px) {
  body {
    padding: calc(15px + var(--safe-area-inset-top)) 
             calc(15px + var(--safe-area-inset-right)) 
             calc(15px + var(--safe-area-inset-bottom)) 
             calc(15px + var(--safe-area-inset-left));
  }
  
  h1 {
    font-size: clamp(1.5rem, 7vw, 2.5rem);
  }
  
  .card {
    padding: 20px;
  }
  
  .btn {
    padding: 12px 25px;
    font-size: 1rem;
  }
  
  .btn-group {
    flex-direction: column;
  }
  
  .btn-group .btn {
    width: 100%;
  }
}

/* Touch Device Optimization */
@media (hover: none) and (pointer: coarse) {
  .btn {
    padding: 18px 35px;
    font-size: 1.15rem;
  }
  
  input,
  textarea,
  select {
    font-size: 16px; /* Prevents zoom on iOS */
    padding: 18px 20px;
  }
}

/* Print Styles */
@media print {
  * {
    background: white !important;
    color: black !important;
    box-shadow: none !important;
    text-shadow: none !important;
  }
}

/* Accessibility */
.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Focus Visible */
:focus-visible {
  outline: 3px solid var(--accent);
  outline-offset: 3px;
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: rgba(26, 0, 51, 0.5);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, var(--secondary), var(--accent));
}

/* File Drop Area */
.file-drop-area {
  border: 3px dashed rgba(157, 78, 221, 0.5);
  border-radius: 15px;
  padding: 40px 20px;
  text-align: center;
  transition: var(--transition);
  background: linear-gradient(135deg, rgba(157, 78, 221, 0.05), rgba(224, 170, 255, 0.05));
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.file-drop-area:hover {
  border-color: var(--accent);
  background: linear-gradient(135deg, rgba(157, 78, 221, 0.1), rgba(224, 170, 255, 0.1));
}

.file-drop-area.drag-over {
  border-color: var(--gold);
  background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(192, 192, 192, 0.1));
  transform: scale(1.02);
}

.file-drop-icon {
  font-size: 3rem;
  color: var(--accent);
  margin-bottom: 15px;
  animation: float 3s ease-in-out infinite;
}

.file-drop-text {
  color: var(--text-secondary);
  font-size: 1rem;
  margin-bottom: 10px;
}

.file-count {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  padding: 5px 15px;
  border-radius: 20px;
  display: inline-block;
  margin-top: 10px;
  font-weight: 600;
}

/* Image Grid Preview */
.image-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.image-preview {
  position: relative;
  aspect-ratio: 1;
  border-radius: 10px;
  overflow: hidden;
  background: linear-gradient(135deg, rgba(157, 78, 221, 0.1), rgba(224, 170, 255, 0.05));
  border: 2px solid transparent;
  transition: var(--transition);
}

.image-preview:hover {
  border-color: var(--accent);
  transform: scale(1.05);
  box-shadow: 0 5px 20px rgba(157, 78, 221, 0.3);
}

.image-preview img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.image-preview .day-number {
  position: absolute;
  top: 5px;
  left: 5px;
  background: rgba(10, 0, 21, 0.8);
  color: var(--gold);
  padding: 3px 8px;
  border-radius: 5px;
  font-size: 0.85rem;
  font-weight: 600;
}

.image-preview .remove-btn {
  position: absolute;
  top: 5px;
  right: 5px;
  width: 25px;
  height: 25px;
  background: rgba(239, 68, 68, 0.8);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: white;
  font-size: 1rem;
  opacity: 0;
  transition: opacity 0.3s;
}

.image-preview:hover .remove-btn {
  opacity: 1;
}

/* Snow Animation */
.snow-particle {
  position: fixed;
  top: -10vh;               /* NEU: Start knapp √ºber dem sichtbaren Bereich */
  color: white;
  pointer-events: none;
  z-index: 999;
  animation: snowfall linear infinite;
  text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
  font-size: 1rem;
}

@keyframes snowfall {
  from {
    transform: translateY(-100vh) rotate(0deg);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  90% {
    opacity: 1;
  }
  to {
    transform: translateY(100vh) rotate(360deg);
    opacity: 0;
  }
}

/* Feature Cards */
.features {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin: 30px 0;
}

.feature-card {
  background: linear-gradient(145deg, rgba(26, 0, 51, 0.8), rgba(45, 27, 78, 0.6));
  border: 1px solid rgba(157, 78, 221, 0.3);
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}

.feature-card:hover {
  transform: translateY(-5px);
  border-color: var(--accent);
  box-shadow: 0 10px 30px rgba(157, 78, 221, 0.3);
}

.feature-icon {
  font-size: 2.5rem;
  margin-bottom: 15px;
  filter: drop-shadow(0 0 20px currentColor);
}

.feature-title {
  font-family: 'Playfair Display', serif;
  font-size: 1.2rem;
  color: var(--accent);
  margin-bottom: 10px;
}

.feature-description {
  color: var(--text-secondary);
  font-size: 0.95rem;
  line-height: 1.5;
}

/* Toggle Switch */
.toggle-container {
  display: flex;
  align-items: center;
  gap: 15px;
  margin: 20px 0;
}

.toggle-switch {
  position: relative;
  width: 60px;
  height: 30px;
  background: rgba(157, 78, 221, 0.3);
  border-radius: 15px;
  cursor: pointer;
  transition: var(--transition);
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  top: 2px;
  left: 2px;
  width: 26px;
  height: 26px;
  background: white;
  border-radius: 50%;
  transition: var(--transition);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.toggle-switch input:checked + .toggle-slider {
  transform: translateX(30px);
  background: var(--gold);
}

.toggle-switch input:checked ~ .toggle-switch {
  background: var(--primary);
}

.toggle-label {
  color: var(--text-secondary);
  font-size: 1rem;
  font-weight: 600;
}

/* Notification Toast */
.toast {
  position: fixed;
  bottom: calc(30px + var(--safe-area-inset-bottom));
  right: calc(30px + var(--safe-area-inset-right));
  background: linear-gradient(135deg, var(--bg-medium), var(--bg-light));
  border: 2px solid var(--accent);
  border-radius: 15px;
  padding: 20px 25px;
  color: var(--text-primary);
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  transform: translateX(calc(100% + 50px));
  transition: transform 0.3s ease;
  z-index: 10000;
  max-width: 350px;
}

.toast.show {
  transform: translateX(0);
}

.toast-title {
  font-weight: 600;
  font-size: 1.1rem;
  margin-bottom: 5px;
  color: var(--accent);
}

.toast-message {
  font-size: 0.95rem;
  color: var(--text-secondary);
}

/* Settings Panel */
.settings-panel {
  background: linear-gradient(135deg, rgba(157, 78, 221, 0.05), rgba(224, 170, 255, 0.02));
  border-radius: 15px;
  padding: 25px;
  margin: 20px 0;
  border: 1px solid rgba(157, 78, 221, 0.2);
}

.settings-title {
  font-family: 'Playfair Display', serif;
  font-size: 1.3rem;
  color: var(--accent);
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.settings-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
}

.setting-item {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.setting-label {
  font-size: 0.9rem;
  color: var(--text-secondary);
  font-weight: 600;
}

/* Color Picker */
.color-picker-wrapper {
  display: flex;
  align-items: center;
  gap: 10px;
}

.color-picker {
  width: 50px;
  height: 50px;
  border-radius: 10px;
  border: 2px solid rgba(157, 78, 221, 0.3);
  cursor: pointer;
  transition: var(--transition);
}

.color-picker:hover {
  border-color: var(--accent);
  transform: scale(1.1);
}

.color-value {
  font-family: 'Courier New', monospace;
  font-size: 0.9rem;
  color: var(--text-secondary);
  background: rgba(0, 0, 0, 0.2);
  padding: 5px 10px;
  border-radius: 5px;
}

/* Animation Classes */
.fade-in {
  animation: fadeIn 0.5s ease forwards;
}

.slide-up {
  animation: slideUp 0.5s ease forwards;
}

.bounce-in {
  animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

@keyframes bounceIn {
  0% {
    opacity: 0;
    transform: scale(0.3);
  }
  50% {
    transform: scale(1.05);
  }
  70% {
    transform: scale(0.9);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

/* Special Effects */
.glow-effect {
  box-shadow: 0 0 20px var(--primary),
              0 0 40px var(--secondary),
              0 0 60px var(--accent);
  animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
  from {
    box-shadow: 0 0 20px var(--primary),
                0 0 40px var(--secondary),
                0 0 60px var(--accent);
  }
  to {
    box-shadow: 0 0 30px var(--primary),
                0 0 60px var(--secondary),
                0 0 90px var(--accent);
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}
</style>
</head>
<body>
<div class="stars" id="stars"></div>

<div class="container">
  <header class="header">
    <h1>Magischer Adventskalender Generator</h1>
    <p class="subtitle">‚ú® Erschaffe deinen eigenen verzauberten Kalender ‚ú®</p>
  </header>

  <div class="card">
    <form id="generatorForm">
      <div class="form-group">
        <label for="title">üéÑ Kalendertitel</label>
        <input 
          type="text" 
          id="title" 
          name="title" 
          placeholder="Mein Magischer Adventskalender 2025"
          maxlength="50"
          required
        >
      </div>

      <div class="form-group">
        <label for="subtitle">üìù Untertitel (optional)</label>
        <input 
          type="text" 
          id="subtitle" 
          name="subtitle" 
          placeholder="24 Tage voller √úberraschungen"
          maxlength="100"
        >
      </div>

      <div class="form-group">
        <label>üñºÔ∏è Bilder hochladen (max. 24)</label>
        <div class="file-drop-area" id="fileDropArea">
          <div class="file-drop-icon">üì∏</div>
          <div class="file-drop-text">
            Bilder hier ablegen oder klicken zum Ausw√§hlen
          </div>
          <input 
            type="file" 
            id="images" 
            name="images" 
            accept="image/*" 
            multiple 
            style="position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer;"
          >
          <div class="file-count" id="fileCount">0 / 24 Bilder</div>
        </div>
        <div class="image-grid" id="imageGrid"></div>
      </div>

      <div class="settings-panel">
        <h3 class="settings-title">‚öôÔ∏è Design-Einstellungen</h3>
        <div class="settings-grid">
          <div class="setting-item">
            <label class="setting-label" for="theme">Farbschema</label>
            <select id="theme" name="theme">
              <option value="purple">Magisches Violett</option>
              <option value="blue">Eisblau</option>
              <option value="gold">Goldener Glanz</option>
              <option value="green">Tannengr√ºn</option>
              <option value="red">Weihnachtsrot</option>
              <option value="custom">Benutzerdefiniert</option>
            </select>
          </div>

          <div class="setting-item">
            <label class="setting-label" for="snowEffect">Schneeeffekt</label>
            <div class="toggle-container">
              <label class="toggle-switch">
                <input type="checkbox" id="snowEffect" checked>
                <span class="toggle-slider"></span>
              </label>
              <span class="toggle-label">Aktiviert</span>
            </div>
          </div>

          <div class="setting-item">
            <label class="setting-label" for="soundEffect">Soundeffekte</label>
            <div class="toggle-container">
              <label class="toggle-switch">
                <input type="checkbox" id="soundEffect" checked>
                <span class="toggle-slider"></span>
              </label>
              <span class="toggle-label">Aktiviert</span>
            </div>
          </div>

          <div class="setting-item">
            <label class="setting-label" for="layout">Layout</label>
            <select id="layout" name="layout">
              <option value="grid">Klassisches Gitter</option>
              <option value="tree">Weihnachtsbaum</option>
              <option value="circle">Kreisf√∂rmig</option>
              <option value="random">Zuf√§llig verteilt</option>
            </select>
          </div>
        </div>
      </div>

      <div class="info-box">
        <p>
          <strong>üí° Tipp:</strong> Lade genau 24 Bilder hoch f√ºr jeden Tag im Dezember. 
          Die Bilder werden automatisch den T√ºrchen zugeordnet. Der generierte Kalender 
          funktioniert auf allen Ger√§ten und kann als HTML-Datei gespeichert werden.
        </p>
      </div>

      <div class="btn-group">
        <button type="button" class="btn btn-primary" id="generateBtn">
          <span>‚ú®</span>
          <span>Kalender Generieren</span>
        </button>
        <button type="button" class="btn btn-success" id="previewBtn" style="display: none;">
          <span>üëÅÔ∏è</span>
          <span>Vorschau</span>
        </button>
      </div>
    </form>
  </div>

  <div class="features">
    <div class="feature-card">
      <div class="feature-icon">üì±</div>
      <h3 class="feature-title">100% Responsive</h3>
      <p class="feature-description">Perfekt optimiert f√ºr alle Ger√§te - iOS, Android, Tablets und Desktop</p>
    </div>
    <div class="feature-card">
      <div class="feature-icon">üé®</div>
      <h3 class="feature-title">Anpassbares Design</h3>
      <p class="feature-description">W√§hle aus verschiedenen Themes und passe deinen Kalender individuell an</p>
    </div>
    <div class="feature-card">
      <div class="feature-icon">üíæ</div>
      <h3 class="feature-title">Offline-F√§hig</h3>
      <p class="feature-description">Speichere als HTML-Datei und teile den Kalender ohne Server</p>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div class="modal" id="successModal">
  <div class="modal-content">
    <button class="close-modal" id="closeModal">&times;</button>
    <div class="success-message">
      <h3>üéâ Kalender erfolgreich erstellt!</h3>
      <p>Dein magischer Adventskalender wurde generiert und heruntergeladen.</p>
    </div>
    <div class="btn-group">
      <button class="btn btn-primary" id="downloadAgain">
        <span>‚¨áÔ∏è</span>
        <span>Erneut herunterladen</span>
      </button>
      <button class="btn btn-success" id="createNew">
        <span>‚ûï</span>
        <span>Neuen erstellen</span>
      </button>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div class="toast" id="toast">
  <div class="toast-title" id="toastTitle">Hinweis</div>
  <div class="toast-message" id="toastMessage">Nachricht</div>
</div>

<script>
// Generate Stars
function generateStars() {
  const starsContainer = document.getElementById('stars');
  const starCount = 50;
  
  for (let i = 0; i < starCount; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    star.style.left = Math.random() * 100 + '%';
    star.style.top = Math.random() * 100 + '%';
    star.style.animationDelay = Math.random() * 3 + 's';
    star.style.animationDuration = (Math.random() * 3 + 2) + 's';
    starsContainer.appendChild(star);
  }
}

// Snow Effect
function createSnowflake() {
  const snowflake = document.createElement('div');
  snowflake.className = 'snow-particle';
  snowflake.textContent = ['‚ùÑ', '‚ùÖ', '‚ùÜ'][Math.floor(Math.random() * 3)];
  snowflake.style.left = Math.random() * 100 + '%';
  snowflake.style.fontSize = (Math.random() * 10 + 10) + 'px';
  snowflake.style.animationDuration = (Math.random() * 3 + 5) + 's';
  document.body.appendChild(snowflake);
  
  setTimeout(() => snowflake.remove(), 8000);
}

// Toast Notification
function showToast(title, message, duration = 3000) {
  const toast = document.getElementById('toast');
  const toastTitle = document.getElementById('toastTitle');
  const toastMessage = document.getElementById('toastMessage');
  
  toastTitle.textContent = title;
  toastMessage.textContent = message;
  toast.classList.add('show');
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, duration);
}

// File Handling
let uploadedImages = [];
const fileDropArea = document.getElementById('fileDropArea');
const fileInput = document.getElementById('images');
const fileCount = document.getElementById('fileCount');
const imageGrid = document.getElementById('imageGrid');

// Drag and Drop
fileDropArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  fileDropArea.classList.add('drag-over');
});

fileDropArea.addEventListener('dragleave', () => {
  fileDropArea.classList.remove('drag-over');
});

fileDropArea.addEventListener('drop', (e) => {
  e.preventDefault();
  fileDropArea.classList.remove('drag-over');
  handleFiles(e.dataTransfer.files);
});

fileInput.addEventListener('change', (e) => {
  handleFiles(e.target.files);
});

function handleFiles(files) {
  const imageFiles = Array.from(files).filter(file => file.type.startsWith('image/'));
  
  if (uploadedImages.length + imageFiles.length > 24) {
    showToast('‚ö†Ô∏è Hinweis', 'Maximal 24 Bilder erlaubt!');
    return;
  }
  
  imageFiles.forEach((file, index) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      uploadedImages.push({
        file: file,
        url: e.target.result,
        day: uploadedImages.length + 1
      });
      updateImageGrid();
    };
    reader.readAsDataURL(file);
  });
}

function updateImageGrid() {
  fileCount.textContent = `${uploadedImages.length} / 24 Bilder`;
  imageGrid.innerHTML = '';
  
  uploadedImages.forEach((img, index) => {
    const preview = document.createElement('div');
    preview.className = 'image-preview';
    preview.innerHTML = `
      <img src="${img.url}" alt="Tag ${img.day}">
      <div class="day-number">Tag ${img.day}</div>
      <div class="remove-btn" data-index="${index}">√ó</div>
    `;
    
    preview.querySelector('.remove-btn').addEventListener('click', (e) => {
      e.stopPropagation();
      removeImage(index);
    });
    
    imageGrid.appendChild(preview);
  });
}

function removeImage(index) {
  uploadedImages.splice(index, 1);
  // Renumber days
  uploadedImages.forEach((img, i) => {
    img.day = i + 1;
  });
  updateImageGrid();
}

// Generate Calendar
document.getElementById('generateBtn').addEventListener('click', generateCalendar);

function generateCalendar() {
  const title = document.getElementById('title').value.trim();
  const subtitle = document.getElementById('subtitle').value.trim();
  const theme = document.getElementById('theme').value;
  const snowEffect = document.getElementById('snowEffect').checked;
  const soundEffect = document.getElementById('soundEffect').checked;
  const layout = document.getElementById('layout').value;
  
  if (!title) {
    showToast('‚ö†Ô∏è Fehler', 'Bitte geben Sie einen Titel ein!');
    return;
  }
  
  if (uploadedImages.length === 0) {
    showToast('‚ö†Ô∏è Fehler', 'Bitte laden Sie mindestens ein Bild hoch!');
    return;
  }
  
  // Show loading spinner
  const generateBtn = document.getElementById('generateBtn');
  generateBtn.innerHTML = '<div class="spinner"></div>';
  generateBtn.disabled = true;
  
  setTimeout(() => {
    const calendarHTML = generateCalendarHTML(title, subtitle, theme, snowEffect, soundEffect, layout);
    downloadCalendar(calendarHTML, title);
    
    generateBtn.innerHTML = '<span>‚ú®</span><span>Kalender Generieren</span>';
    generateBtn.disabled = false;
    
    // Show success modal
    document.getElementById('successModal').classList.add('active');
  }, 1500);
}

function generateCalendarHTML(title, subtitle, theme, snowEffect, soundEffect, layout) {
  // Theme colors
  const themes = {
    purple: {
      primary: '#9d4edd',
      secondary: '#c77dff',
      accent: '#e0aaff',
      bg: 'linear-gradient(135deg, #0a0015 0%, #1a0033 25%, #2d1b4e 50%, #1a0033 75%, #0a0015 100%)'
    },
    blue: {
      primary: '#3b82f6',
      secondary: '#60a5fa',
      accent: '#93c5fd',
      bg: 'linear-gradient(135deg, #001529 0%, #003366 25%, #004d99 50%, #003366 75%, #001529 100%)'
    },
    gold: {
      primary: '#fbbf24',
      secondary: '#fcd34d',
      accent: '#fde68a',
      bg: 'linear-gradient(135deg, #1a1000 0%, #332200 25%, #664400 50%, #332200 75%, #1a1000 100%)'
    },
    green: {
      primary: '#10b981',
      secondary: '#34d399',
      accent: '#6ee7b7',
      bg: 'linear-gradient(135deg, #001a0d 0%, #00331a 25%, #004d26 50%, #00331a 75%, #001a0d 100%)'
    },
    red: {
      primary: '#ef4444',
      secondary: '#f87171',
      accent: '#fca5a5',
      bg: 'linear-gradient(135deg, #1a0000 0%, #330000 25%, #660000 50%, #330000 75%, #1a0000 100%)'
    },
    custom: {
      primary: '#9d4edd',
      secondary: '#c77dff',
      accent: '#e0aaff',
      bg: 'linear-gradient(135deg, #0a0015 0%, #1a0033 25%, #2d1b4e 50%, #1a0033 75%, #0a0015 100%)'
    }
  };
  
  const selectedTheme = themes[theme] || themes.purple;
  
  // Create image map for calendar
  const imageMap = {};
  uploadedImages.forEach(img => {
    imageMap[img.day] = img.url;
  });
  
  // Generate complete HTML
  return `<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>${title}</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,minimum-scale=1.0,maximum-scale=5.0,user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="${selectedTheme.primary}">
<meta name="format-detection" content="telephone=no">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html, body {
  width: 100%;
  height: 100%;
  overflow-x: hidden;
}

body {
  font-family: 'Quicksand', -apple-system, sans-serif;
  background: ${selectedTheme.bg};
  background-attachment: fixed;
  color: #f0e6ff;
  min-height: 100vh;
  min-height: -webkit-fill-available;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: env(safe-area-inset-top, 20px) env(safe-area-inset-right, 20px) env(safe-area-inset-bottom, 20px) env(safe-area-inset-left, 20px);
  position: relative;
}

@keyframes glow {
  0%, 100% { filter: drop-shadow(0 0 20px ${selectedTheme.primary}); }
  50% { filter: drop-shadow(0 0 40px ${selectedTheme.accent}); }
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-15px); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0) rotate(0); }
  25% { transform: translateX(-5px) rotate(-2deg); }
  75% { transform: translateX(5px) rotate(2deg); }
}

@keyframes doorOpen {
  0% { transform: rotateY(0); }
  100% { transform: rotateY(-120deg); }
}

@keyframes snowfall {
  from {
    transform: translateY(-100vh) rotate(0deg);
    opacity: 0;
  }
  10% { opacity: 1; }
  90% { opacity: 1; }
  to {
    transform: translateY(100vh) rotate(360deg);
    opacity: 0;
  }
}

@keyframes sparkle {
  0%, 100% { opacity: 0; transform: scale(0); }
  50% { opacity: 1; transform: scale(1); }
}

.header {
  text-align: center;
  margin-bottom: 40px;
  animation: float 4s ease-in-out infinite;
}

h1 {
  font-family: 'Cinzel Decorative', serif;
  font-size: clamp(2rem, 6vw, 4rem);
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 3px;
  text-align: center;

  /* Fallback-Farbe f√ºr Ger√§te, die Gradient-Text nicht sauber k√∂nnen */
  color: #f8ecff;

  /* Sch√∂ner Farbverlauf, wo unterst√ºtzt */
  background: linear-gradient(
    135deg,
    ${selectedTheme.accent},
    ${selectedTheme.primary},
    ${selectedTheme.secondary},
    ${selectedTheme.accent}
  );
  background-size: 200% 200%;
  background-clip: text;
  -webkit-background-clip: text;

  /* Leucht-Effekt */
  animation: glow 3s ease-in-out infinite;
}

.subtitle {
  font-family: 'Playfair Display', serif;
  font-size: clamp(1rem, 3vw, 1.5rem);
  color: ${selectedTheme.secondary};
  margin-top: 10px;
  font-style: italic;
  opacity: 0.9;
}

.calendar-grid {
  display: grid;
  grid-template-columns: repeat(6, minmax(80px, 120px));
  gap: 20px;
  padding: 30px;
  background: rgba(10, 0, 21, 0.7);
  border-radius: 30px;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  position: relative;
  max-width: 900px;
  width: 100%;
}

@media (max-width: 768px) {
  .calendar-grid {
    grid-template-columns: repeat(4, minmax(70px, 1fr));
    gap: 15px;
    padding: 20px;
  }
}

@media (max-width: 480px) {
  .calendar-grid {
    grid-template-columns: repeat(3, minmax(60px, 1fr));
    gap: 10px;
    padding: 15px;
  }
}

.door {
  aspect-ratio: 1;
  background: linear-gradient(145deg, rgba(${selectedTheme.primary}, 0.2), rgba(${selectedTheme.secondary}, 0.1));
  border: 2px solid ${selectedTheme.primary};
  border-radius: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Cinzel Decorative', serif;
  font-size: clamp(1.5rem, 3vw, 2rem);
  font-weight: 700;
  color: ${selectedTheme.accent};
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  transform-style: preserve-3d;
  perspective: 1000px;
  -webkit-tap-highlight-color: transparent;
}

.door:hover:not(.locked) {
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 10px 30px rgba(${selectedTheme.primary}, 0.5);
  border-color: ${selectedTheme.accent};
}

.door.locked {
  opacity: 0.6;
  cursor: not-allowed;
}

.door.locked::after {
  content: "üîí";
  position: absolute;
  top: 5px;
  right: 5px;
  font-size: 1rem;
}

.door.opened {
  background: linear-gradient(145deg, rgba(255, 215, 0, 0.2), rgba(255, 255, 255, 0.1));
  border-color: gold;
}

.door.opened .door-number {
  color: gold;
}

.door.shaking {
  animation: shake 0.5s ease;
}

.door-number {
  position: relative;
  z-index: 2;
  text-shadow: 0 0 20px currentColor;
}

.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.95);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 1000;
  padding: 20px;
  overflow-y: auto;
}

.modal.active {
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.modal-content {
  background: linear-gradient(145deg, rgba(26, 0, 51, 0.98), rgba(45, 27, 78, 0.95));
  border: 2px solid ${selectedTheme.primary};
  border-radius: 25px;
  max-width: 600px;
  width: 90%;
  max-height: 85vh;
  overflow-y: auto;
  padding: 30px;
  position: relative;
  animation: slideUp 0.4s ease;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

@keyframes slideUp {
  from {
    transform: translateY(50px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.modal-header {
  text-align: center;
  margin-bottom: 25px;
  position: relative;
}

.modal-title {
  font-family: 'Cinzel Decorative', serif;
  font-size: 1.8rem;
  color: ${selectedTheme.accent};
  margin-bottom: 10px;
}

.modal-date {
  color: ${selectedTheme.secondary};
  font-size: 1rem;
  opacity: 0.8;
}

.modal-image {
  width: 100%;
  height: auto;
  max-height: 400px;
  object-fit: contain;
  border-radius: 15px;
  margin: 20px 0;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.modal-close {
  position: absolute;
  top: 15px;
  right: 15px;
  width: 40px;
  height: 40px;
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid ${selectedTheme.secondary};
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1.5rem;
  color: ${selectedTheme.secondary};
}

.modal-close:hover {
  background: ${selectedTheme.secondary};
  color: white;
  transform: rotate(90deg) scale(1.1);
}

.snow-particle {
  position: fixed;
  color: white;
  pointer-events: none;
  z-index: 999;
  animation: snowfall linear infinite;
  text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
  font-size: 1rem;
}

.sparkle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: white;
  border-radius: 50%;
  pointer-events: none;
  animation: sparkle 1s ease;
  box-shadow: 0 0 6px white;
}

.sound-toggle {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 50px;
  height: 50px;
  background: rgba(${selectedTheme.primary}, 0.8);
  border: 2px solid ${selectedTheme.accent};
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1.5rem;
  z-index: 100;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
}

.sound-toggle:hover {
  transform: scale(1.1);
  background: ${selectedTheme.secondary};
}

.sound-toggle.muted {
  opacity: 0.5;
}

@media (hover: none) and (pointer: coarse) {
  .door {
    font-size: clamp(1.2rem, 4vw, 1.8rem);
  }
  
  .modal-content {
    width: 95%;
    max-height: 90vh;
    padding: 20px;
  }
  
  .sound-toggle {
    width: 60px;
    height: 60px;
    font-size: 1.8rem;
  }
}

@supports (-webkit-touch-callout: none) {
  body {
    min-height: -webkit-fill-available;
  }
  
  .modal {
    padding-bottom: env(safe-area-inset-bottom);
  }
}

.info-message {
  background: linear-gradient(135deg, rgba(${selectedTheme.primary}, 0.1), rgba(${selectedTheme.secondary}, 0.05));
  border: 1px solid ${selectedTheme.primary};
  border-radius: 15px;
  padding: 15px;
  margin: 20px 0;
  text-align: center;
  color: ${selectedTheme.accent};
  font-size: 0.9rem;
}

@media print {
  * {
    background: white !important;
    color: black !important;
  }
}
</style>
</head>
<body>
<div class="header">
  <h1>${title}</h1>
  ${subtitle ? `<p class="subtitle">${subtitle}</p>` : ''}
</div>

<div class="calendar-grid" id="calendar">
  <!-- Doors will be generated here -->
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <button class="modal-close" id="closeModal">&times;</button>
    <div class="modal-header">
      <h2 class="modal-title" id="modalTitle">T√ºrchen</h2>
      <p class="modal-date" id="modalDate">Datum</p>
    </div>
    <img class="modal-image" id="modalImage" alt="">
    <div class="info-message">
      üéÅ Frohe Weihnachtszeit! üéÅ
    </div>
  </div>
</div>

${soundEffect ? '<button class="sound-toggle" id="soundToggle">üîä</button>' : ''}

<footer class="footer">
  <p>¬© 2025 Manfred Foissner ¬∑ All rights reserved</p>
</footer>

<script>
(function() {
  const imageMap = ${JSON.stringify(imageMap)};
  const calendar = document.getElementById('calendar');
  const modal = document.getElementById('modal');
  const closeModal = document.getElementById('closeModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalDate = document.getElementById('modalDate');
  const modalImage = document.getElementById('modalImage');
  ${soundEffect ? 'const soundToggle = document.getElementById("soundToggle");' : ''}
  
  const now = new Date();
  const currentYear = now.getFullYear();
  const currentMonth = now.getMonth();
  const currentDay = now.getDate();
  
  ${soundEffect ? `
  let soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
  soundToggle.textContent = soundEnabled ? 'üîä' : 'üîá';
  soundToggle.classList.toggle('muted', !soundEnabled);
  
  soundToggle.addEventListener('click', () => {
    soundEnabled = !soundEnabled;
    localStorage.setItem('soundEnabled', soundEnabled);
    soundToggle.textContent = soundEnabled ? 'üîä' : 'üîá';
    soundToggle.classList.toggle('muted', !soundEnabled);
  });
  
  function playSound(type) {
    if (!soundEnabled) return;
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      
      osc.connect(gain);
      gain.connect(ctx.destination);
      
      if (type === 'open') {
        osc.frequency.setValueAtTime(523.25, ctx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(1046.5, ctx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.3, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
        osc.start(ctx.currentTime);
        osc.stop(ctx.currentTime + 0.3);
      } else if (type === 'locked') {
        osc.frequency.setValueAtTime(200, ctx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.2, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
        osc.start(ctx.currentTime);
        osc.stop(ctx.currentTime + 0.1);
      }
    } catch(e) {}
  }` : ''}
  
  ${snowEffect ? `
  function createSnow() {
    for (let i = 0; i < 30; i++) {
      setTimeout(() => {
        const snow = document.createElement('div');
        snow.className = 'snow-particle';
        snow.textContent = ['‚ùÑ', '‚ùÖ', '‚ùÜ'][Math.floor(Math.random() * 3)];
        snow.style.left = Math.random() * 100 + '%';
        snow.style.fontSize = (Math.random() * 10 + 10) + 'px';
        snow.style.animationDuration = (Math.random() * 5 + 10) + 's';
        snow.style.animationDelay = Math.random() * 5 + 's';
        document.body.appendChild(snow);
        
        setTimeout(() => snow.remove(), 15000);
      }, Math.random() * 5000);
    }
  }
  
  createSnow();
  setInterval(createSnow, 15000);` : ''}
  
  function createSparkles(x, y) {
    for (let i = 0; i < 20; i++) {
      setTimeout(() => {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.left = x + 'px';
        sparkle.style.top = y + 'px';
        const angle = (Math.PI * 2 * i) / 20;
        const distance = Math.random() * 100 + 50;
        sparkle.style.transform = \`translate(\${Math.cos(angle) * distance}px, \${Math.sin(angle) * distance}px)\`;
        document.body.appendChild(sparkle);
        
        setTimeout(() => sparkle.remove(), 1000);
      }, i * 30);
    }
  }
  
  // Create doors
  for (let day = 1; day <= 24; day++) {
    const door = document.createElement('div');
    door.className = 'door';
    door.dataset.day = day;
    
    const isUnlocked = currentMonth === 11 && currentDay >= day;
    const isOpened = localStorage.getItem(\`door_\${currentYear}_\${day}\`) === 'opened';
    
    if (!isUnlocked) {
      door.classList.add('locked');
    }
    
    if (isOpened) {
      door.classList.add('opened');
    }
    
    const doorNumber = document.createElement('div');
    doorNumber.className = 'door-number';
    doorNumber.textContent = day;
    door.appendChild(doorNumber);
    
    door.addEventListener('click', function(e) {
      const rect = door.getBoundingClientRect();
      const x = rect.left + rect.width / 2;
      const y = rect.top + rect.height / 2;
      
      if (!isUnlocked) {
        ${soundEffect ? "playSound('locked');" : ''}
        door.classList.add('shaking');
        setTimeout(() => door.classList.remove('shaking'), 500);
        
        const daysLeft = day - currentDay;
        alert(\`üîí Dieses T√ºrchen √∂ffnet sich am \${day}. Dezember!\\n\\nNoch \${daysLeft} Tag\${daysLeft === 1 ? '' : 'e'} warten!\`);
        return;
      }
      
      if (!imageMap[day]) {
        alert('üì≠ F√ºr dieses T√ºrchen wurde kein Bild hinterlegt.');
        return;
      }
      
      ${soundEffect ? "playSound('open');" : ''}
      createSparkles(x, y);
      
      if (!door.classList.contains('opened')) {
        door.classList.add('opened');
        localStorage.setItem(\`door_\${currentYear}_\${day}\`, 'opened');
      }
      
      modalTitle.textContent = \`T√ºrchen \${day}\`;
      modalDate.textContent = \`\${day}. Dezember \${currentYear}\`;
      modalImage.src = imageMap[day];
      modalImage.alt = \`Bild f√ºr Tag \${day}\`;
      modal.classList.add('active');
    });
    
    calendar.appendChild(door);
  }
  
  // Shuffle doors for random layout
  ${layout === 'random' ? `
  const doors = Array.from(calendar.children);
  for (let i = doors.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    calendar.appendChild(doors[j]);
  }` : ''}
  
  // Close modal
  closeModal.addEventListener('click', () => {
    modal.classList.remove('active');
  });
  
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.classList.remove('active');
    }
  });
  
  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal.classList.contains('active')) {
      modal.classList.remove('active');
    }
  });
})();
<\/script>
</body>
</html>`;
}



function downloadCalendar(html, title) {
  const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `${title.replace(/[^a-z0-9√§√∂√º√ü ]/gi, '_')}_Adventskalender_2025.html`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
  
  showToast('‚úÖ Erfolg', 'Kalender wurde heruntergeladen!', 5000);
}

// Modal handlers
document.getElementById('closeModal').addEventListener('click', () => {
  document.getElementById('successModal').classList.remove('active');
});

document.getElementById('downloadAgain').addEventListener('click', () => {
  const title = document.getElementById('title').value.trim();
  const subtitle = document.getElementById('subtitle').value.trim();
  const theme = document.getElementById('theme').value;
  const snowEffect = document.getElementById('snowEffect').checked;
  const soundEffect = document.getElementById('soundEffect').checked;
  const layout = document.getElementById('layout').value;
  
  const calendarHTML = generateCalendarHTML(title, subtitle, theme, snowEffect, soundEffect, layout);
  downloadCalendar(calendarHTML, title);
});

document.getElementById('createNew').addEventListener('click', () => {
  document.getElementById('successModal').classList.remove('active');
  document.getElementById('generatorForm').reset();
  uploadedImages = [];
  updateImageGrid();
});

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  generateStars();
  
  // Create occasional snowflakes
  if (document.getElementById('snowEffect').checked) {
    setInterval(createSnowflake, 500);
  }
  
  // Toggle snow effect
  document.getElementById('snowEffect').addEventListener('change', (e) => {
    if (e.target.checked) {
      setInterval(createSnowflake, 500);
    }
  });
});
</script>
</body>
</html>
