<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Adventkalender ‚Äì Pers√∂nlicher Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Erstelle deinen eigenen personalisierten Adventkalender mit deinen Fotos">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #020617 0%, #0f172a 50%, #020617 100%);
      color: #e5e7eb;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .container {
      max-width: 700px;
      width: 100%;
    }

    h1 {
      text-align: center;
      margin-bottom: 8px;
      font-size: clamp(1.8rem, 4vw, 2.4rem);
      background: linear-gradient(135deg, #facc15, #fbbf24);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hint {
      text-align: center;
      font-size: 0.9rem;
      color: #9ca3af;
      margin-bottom: 24px;
      line-height: 1.6;
    }

    .hint strong {
      color: #22c55e;
    }

    .card {
      border-radius: 16px;
      border: 1px solid #374151;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(10px);
      padding: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    label {
      display: block;
      margin-bottom: 12px;
      font-weight: 600;
      font-size: 1.05rem;
      color: #f3f4f6;
    }

    .file-input-wrapper {
      position: relative;
      margin-bottom: 16px;
    }

    input[type="file"] {
      width: 100%;
      padding: 14px;
      border: 2px dashed #4b5563;
      border-radius: 12px;
      background: rgba(31, 41, 55, 0.5);
      color: #d1d5db;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    input[type="file"]:hover {
      border-color: #22c55e;
      background: rgba(31, 41, 55, 0.8);
    }

    input[type="file"]::file-selector-button {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      background: linear-gradient(135deg, #16a34a, #22c55e);
      color: white;
      font-weight: 600;
      cursor: pointer;
      margin-right: 12px;
      transition: transform 0.2s ease;
    }

    input[type="file"]::file-selector-button:hover {
      transform: scale(1.05);
    }

    ul {
      font-size: 0.85rem;
      color: #9ca3af;
      padding-left: 20px;
      margin-bottom: 16px;
      line-height: 1.8;
    }

    ul li {
      margin-bottom: 6px;
    }

    .settings {
      background: rgba(31, 41, 55, 0.5);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .settings h3 {
      font-size: 0.95rem;
      color: #fbbf24;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .slider-container {
      margin-bottom: 12px;
    }

    .slider-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 0.85rem;
      color: #d1d5db;
    }

    .slider-value {
      color: #22c55e;
      font-weight: 600;
    }

    input[type="range"] {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #374151;
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: linear-gradient(135deg, #16a34a, #22c55e);
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(34, 197, 94, 0.4);
    }

    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: linear-gradient(135deg, #16a34a, #22c55e);
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 8px rgba(34, 197, 94, 0.4);
    }

    button {
      width: 100%;
      padding: 14px 24px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #16a34a, #22c55e);
      color: white;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 16px rgba(34, 197, 94, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .progress-container {
      display: none;
      margin-top: 20px;
      padding: 16px;
      background: rgba(31, 41, 55, 0.5);
      border-radius: 12px;
    }

    .progress-container.visible {
      display: block;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #374151;
      border-radius: 999px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #16a34a, #22c55e);
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 999px;
    }

    .progress-text {
      font-size: 0.85rem;
      color: #d1d5db;
      text-align: center;
    }

    .status {
      margin-top: 16px;
      padding: 12px;
      border-radius: 8px;
      font-size: 0.85rem;
      line-height: 1.6;
      display: none;
    }

    .status.visible {
      display: block;
    }

    .status.success {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: #86efac;
    }

    .status.error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #fca5a5;
    }

    .status.info {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #93c5fd;
    }

    code {
      background: #111827;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.85em;
      color: #fbbf24;
    }

    footer {
      text-align: center;
      margin-top: 32px;
      font-size: 0.8rem;
      color: #6b7280;
    }

    footer a {
      color: #22c55e;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .card {
        padding: 20px;
      }

      h1 {
        font-size: 1.6rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéÑ Adventkalender Generator</h1>
    <p class="hint">
      Erstelle deinen <strong>pers√∂nlichen Adventkalender</strong> mit eigenen Fotos.<br>
      Die Bilder bleiben auf deinem Ger√§t ‚Äì es wird eine einzelne HTML-Datei erzeugt,<br>
      die du per WhatsApp, E-Mail oder Link teilen kannst. ‚ú®
    </p>

    <div class="card">
      <label for="files-input">
        üì∏ W√§hle 1‚Äì24 Bilder aus (JPG oder PNG):
      </label>
      
      <div class="file-input-wrapper">
        <input 
          id="files-input" 
          type="file" 
          accept="image/jpeg,image/jpg,image/png,image/webp" 
          multiple
        >
      </div>

      <ul>
        <li>Die Reihenfolge richtet sich nach <strong>Dateinamen</strong> (alphabetisch sortiert)</li>
        <li>Bild 1 ‚Üí T√ºrchen 1, Bild 2 ‚Üí T√ºrchen 2, usw.</li>
        <li>Du kannst mit 1 Bild testen ‚Äì dann hat nur T√ºrchen 1 ein Foto</li>
        <li>Bilder werden automatisch komprimiert f√ºr schnelleren Versand</li>
      </ul>

      <div class="settings">
        <h3>‚öôÔ∏è Einstellungen</h3>
        
        <div class="slider-container">
          <div class="slider-label">
            <span>Bildqualit√§t (kleinere Dateigr√∂√üe = schnellerer Versand)</span>
            <span class="slider-value" id="quality-value">80%</span>
          </div>
          <input 
            type="range" 
            id="quality-slider" 
            min="50" 
            max="95" 
            value="80" 
            step="5"
          >
        </div>

        <div class="slider-container">
          <div class="slider-label">
            <span>Maximale Bildbreite (px)</span>
            <span class="slider-value" id="width-value">1200px</span>
          </div>
          <input 
            type="range" 
            id="width-slider" 
            min="800" 
            max="2000" 
            value="1200" 
            step="100"
          >
        </div>
      </div>

      <button id="generate-btn">
        <span>üéÅ</span>
        <span>Kalender erstellen</span>
      </button>

      <div class="progress-container" id="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text">Verarbeite Bilder...</div>
      </div>

      <div class="status" id="status"></div>
    </div>

    <footer>
      Made with ‚ù§Ô∏è for creating personal advent calendars<br>
      <a href="https://github.com/M4nfr41D-spec/ADVENT-ANDROID" target="_blank">View on GitHub</a>
    </footer>
  </div>

<script>
  window.addEventListener('load', () => {
    const TOTAL_DAYS = 24;
    const filesInput = document.getElementById('files-input');
    const statusEl = document.getElementById('status');
    const btn = document.getElementById('generate-btn');
    const progressContainer = document.getElementById('progress-container');
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');
    const qualitySlider = document.getElementById('quality-slider');
    const qualityValue = document.getElementById('quality-value');
    const widthSlider = document.getElementById('width-slider');
    const widthValue = document.getElementById('width-value');

    // Slider-Labels
    qualitySlider.addEventListener('input', (e) => {
      qualityValue.textContent = e.target.value + '%';
    });

    widthSlider.addEventListener('input', (e) => {
      widthValue.textContent = e.target.value + 'px';
    });

    function showStatus(message, type = 'info') {
      statusEl.textContent = message;
      statusEl.className = 'status visible ' + type;
    }

    function hideStatus() {
      statusEl.className = 'status';
      statusEl.textContent = '';
    }

    function updateProgress(percent, text) {
      progressFill.style.width = percent + '%';
      progressText.textContent = text;
    }

    function showProgress() {
      progressContainer.classList.add('visible');
    }

    function hideProgress() {
      progressContainer.classList.remove('visible');
      progressFill.style.width = '0%';
      progressText.textContent = '';
    }

    async function compressImage(file, maxWidth, quality) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();

        reader.onload = (e) => {
          const img = new Image();

          img.onload = () => {
            const canvas = document.createElement('canvas');
            let width = img.width;
            let height = img.height;

            if (width > maxWidth) {
              height = (height * maxWidth) / width;
              width = maxWidth;
            }

            canvas.width = width;
            canvas.height = height;

            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);

            // Fallback falls canvas.toBlob nicht unterst√ºtzt wird
            if (typeof canvas.toBlob !== 'function') {
              try {
                const dataUrl = canvas.toDataURL('image/jpeg', quality / 100);
                return resolve(dataUrl);
              } catch (err) {
                return reject(err);
              }
            }

            canvas.toBlob(
              (blob) => {
                if (blob) {
                  const compressedReader = new FileReader();
                  compressedReader.onload = () => resolve(compressedReader.result);
                  compressedReader.onerror = reject;
                  compressedReader.readAsDataURL(blob);
                } else {
                  reject(new Error('Komprimierung fehlgeschlagen'));
                }
              },
              'image/jpeg',
              quality / 100
            );
          };

          img.onerror = () => reject(new Error('Bild konnte nicht geladen werden'));
          img.src = e.target.result;
        };

        reader.onerror = () => reject(new Error('Datei konnte nicht gelesen werden'));
        reader.readAsDataURL(file);
      });
    }

    btn.addEventListener('click', async () => {
      hideStatus();
      hideProgress();

      const fileList = filesInput.files;
      if (!fileList || fileList.length === 0) {
        showStatus('‚ö†Ô∏è Bitte mindestens 1 Bild ausw√§hlen.', 'error');
        return;
      }

      let count = fileList.length;
      const maxWidth = parseInt(widthSlider.value, 10);
      const quality = parseInt(qualitySlider.value, 10);

      if (count > TOTAL_DAYS) {
        showStatus(
          `‚ÑπÔ∏è Du hast ${count} Bilder ausgew√§hlt. Es werden nur die ersten ${TOTAL_DAYS} verwendet.`,
          'info'
        );
        count = TOTAL_DAYS;
      }

      const files = Array.from(fileList)
        .sort((a, b) =>
          a.name.localeCompare(b.name, undefined, { numeric: true, sensitivity: 'base' })
        )
        .slice(0, count);

      btn.disabled = true;
      showProgress();

      try {
        const images = [];

        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          const day = i + 1;

          updateProgress(
            ((i + 1) / files.length) * 100,
            `Verarbeite Bild ${i + 1} von ${files.length} (T√ºrchen ${day})...`
          );

          const dataUrl = await compressImage(file, maxWidth, quality);

          images.push({
            day,
            name: file.name,
            src: dataUrl
          });
        }

        updateProgress(100, 'Erstelle Kalender-Datei...');

        const calendarHtml = buildCalendarHtml(images);

        // 1) Kalender in neuem Tab anzeigen (direkte Vorschau)
        try {
          const previewWindow = window.open();
          if (previewWindow && previewWindow.document) {
            previewWindow.document.open();
            previewWindow.document.write(calendarHtml);
            previewWindow.document.close();
          }
        } catch (e) {
          console.warn('Konnte Vorschau-Tab nicht √∂ffnen:', e);
        }

        // 2) Kalender als Datei herunterladen
        try {
          const blob = new Blob([calendarHtml], { type: 'text/html;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'mein_adventkalender_2024.html';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          setTimeout(() => URL.revokeObjectURL(url), 2000);
        } catch (e) {
          console.error('Download fehlgeschlagen:', e);
          showStatus(
            'Der automatische Download hat nicht geklappt. ' +
              'Du kannst im neuen Tab √ºber dein Browser-Men√º ‚ÄûSeite speichern‚Äú w√§hlen.',
            'info'
          );
        }

        hideProgress();
        showStatus(
          '‚úÖ Fertig! Dein Adventkalender wurde erstellt.\n\n' +
            'üì± Im neuen Tab kannst du ihn direkt testen.\n' +
            'üíæ Au√üerdem wurde eine HTML-Datei zum Download angeboten.',
          'success'
        );
      } catch (err) {
        console.error(err);
        hideProgress();
        showStatus(
          '‚ùå Fehler beim Erstellen des Kalenders:\n' +
            (err && err.message ? err.message : String(err)),
          'error'
        );
      } finally {
        btn.disabled = false;
      }
    });

    function buildCalendarHtml(images) {
      const imagesJson = JSON.stringify(images);
      const year = new Date().getFullYear();

      return `<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mein pers√∂nlicher Adventkalender ${year}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Afacad:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- STYLES & SCRIPT aus deiner bisherigen Version ‚Äì unver√§ndert √ºbernommen -->
  ${/* hier bleibt der gesamte bisherige Adventkalender-HTML-Teil aus deiner Datei,
       den du schon drin hast ‚Äì ich k√ºrze nur in dieser Antwort */''}
</head>
</html>`;
    }
  });
</script>
    const CALENDAR_IMAGES = ${imagesJson};
    const TOTAL_DAYS = 24;
    const now = new Date();
    const currentYear = ${year};

    const imageMap = {};
    for (const img of CALENDAR_IMAGES) {
      imageMap[img.day] = img;
    }

    const STORAGE_KEY = "advent-opened-" + currentYear + "-personal";

    (function () {
      const todayInfoEl = document.getElementById("today-info");
      const grid = document.getElementById("calendar-grid");

      const modalBackdrop = document.getElementById("photo-modal-backdrop");
      const modalImage = document.getElementById("modal-image");
      const modalTitle = document.getElementById("modal-title");
      const downloadLink = document.getElementById("download-link");
      const closeModalBtn = document.getElementById("close-modal-btn");

      let openedDays = loadOpenedDays();

      todayInfoEl.textContent = "Heute ist: " + formatDate(now);

      for (let day = 1; day <= TOTAL_DAYS; day++) {
        const door = document.createElement("button");
        door.classList.add("door");
        door.setAttribute("data-day", String(day));
        door.type = "button";

        const isUnlocked = isDoorUnlocked(day);
        const isOpened = openedDays.includes(day);
        const hasImage = !!imageMap[day];

        if (!isUnlocked) {
          door.classList.add("locked");
        } else {
          door.classList.add("unlocked");
        }

        if (isOpened && isUnlocked) {
          door.classList.add("opened");
        }

        door.innerHTML =
          '<div class="door-number">' + day + '</div>' +
          '<div class="door-label">Dezember</div>' +
          '<div class="door-status">' +
            '<span class="door-status-icon">' +
              (!isUnlocked ? "üîí" : (isOpened ? "üéâ" : (hasImage ? "üéÅ" : "‚úñÔ∏è"))) +
            '</span>' +
            '<span class="door-status-text">' +
              (!isUnlocked ? "Noch gesperrt" :
                (isOpened ? "Ge√∂ffnet" :
                  (hasImage ? "Bereit zum √ñffnen" : "Kein Bild hinterlegt"))) +
            '</span>' +
          '</div>';

        door.addEventListener("click", () => {
          if (!isDoorUnlocked(day)) {
            const dateStr = formatDate(new Date(currentYear, 11, day, 0, 0, 0));
            alert("Dieses T√ºrchen √∂ffnet sich erst am " + dateStr + ".");
            return;
          }

          const img = imageMap[day];
          if (!img) {
            alert("F√ºr dieses T√ºrchen wurde kein Bild hinterlegt.");
            return;
          }

          markDoorOpened(day, door);
          openPhoto(day, img);
        });

        grid.appendChild(door);
      }

      modalBackdrop.addEventListener("click", (event) => {
        if (event.target === modalBackdrop) {
          hideModal();
        }
      });

      closeModalBtn.addEventListener("click", hideModal);
      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && modalBackdrop.classList.contains("visible")) {
          hideModal();
        }
      });

      function isDoorUnlocked(day) {
        const openDate = new Date(currentYear, 11, day, 0, 0, 0);
        return now >= openDate;
      }

      function loadOpenedDays() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return [];
          const arr = JSON.parse(raw);
          if (!Array.isArray(arr)) return [];
          return arr.map(Number).filter((n) => Number.isInteger(n) && n >= 1 && n <= TOTAL_DAYS);
        } catch {
          return [];
        }
      }

      function saveOpenedDays(days) {
        const unique = Array.from(new Set(days)).sort((a, b) => a - b);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(unique));
      }

      function markDoorOpened(day, doorEl) {
        if (!openedDays.includes(day)) {
          openedDays.push(day);
          saveOpenedDays(openedDays);
        }

        doorEl.classList.remove("locked", "unlocked");
        doorEl.classList.add("opened");

        const statusIcon = doorEl.querySelector(".door-status-icon");
        const statusText = doorEl.querySelector(".door-status-text");
        if (statusIcon) statusIcon.textContent = "üéâ";
        if (statusText) statusText.textContent = "Ge√∂ffnet";
      }

      function openPhoto(day, img) {
        modalImage.src = img.src;
        modalTitle.textContent = "T√ºrchen " + day + " ‚Äì " + day + ". Dezember";
        downloadLink.href = img.src;
        downloadLink.setAttribute(
          "download",
          "Advent_" + currentYear + "_Tag_" + String(day).padStart(2, "0") + ".jpg"
        );
        modalBackdrop.classList.add("visible");
      }

      function hideModal() {
        modalBackdrop.classList.remove("visible");
        modalImage.src = "";
      }

      function formatDate(date) {
        return date.toLocaleDateString("de-AT", {
          weekday: "short",
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
        });
      }
    })();
  </script>
</body>
</html>`;
    }
  </script>
</body>
</html>